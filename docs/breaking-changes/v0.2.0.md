# Breaking Change: v0.2.0

## Gateway-Level SecurityPolicies No Longer Supported

Gateway-level SecurityPolicies are no longer supported due to CAPTCHA redirect limitations. Individual HTTPRoutes cannot be excluded from gateway-level policies, which breaks the bouncer's redirect mechanism.

## Migration Required

If you were using gateway-level SecurityPolicies, you must migrate to HTTPRoute-level policies.

### Creating HTTPRoute-Level SecurityPolicies

SecurityPolicies should be created in the same namespace as your HTTPRoutes:

```yaml
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: SecurityPolicy
metadata:
  name: media-security
  namespace: media
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: plex
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: overseerr
  extAuth:
    grpc:
      backendRefs:
        - group: ""
          kind: Service
          name: envoy-proxy-bouncer
          port: 8080
          namespace: envoy-gateway-system
```

### Example: Multiple Namespaces

If you have HTTPRoutes across multiple namespaces, create a SecurityPolicy in each namespace.

### ReferenceGrant Configuration

When SecurityPolicies reference services in different namespaces, a ReferenceGrant is required:

```yaml
apiVersion: gateway.networking.k8s.io/v1beta1
kind: ReferenceGrant
metadata:
  name: bouncer-access
  namespace: envoy-gateway-system
spec:
  from:
  - group: gateway.envoyproxy.io
    kind: SecurityPolicy
    namespace: media
  - group: gateway.envoyproxy.io
    kind: SecurityPolicy
    namespace: blog
  - group: gateway.envoyproxy.io
    kind: SecurityPolicy
    namespace: argocd
  to:
  - group: ""
    kind: Service
    name: envoy-proxy-bouncer
```

## See Also

- [Deployment Guide](../DEPLOYMENT.md)
- [Configuration Guide](../CONFIGURATION.md)
